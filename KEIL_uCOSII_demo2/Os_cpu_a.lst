


ARM Macro Assembler    Page 1 


    1 00000000         ;*******************************************************
                       **************************************************
    2 00000000         ;                                               uC/OS-II
                       
    3 00000000         ;                                         The Real-Time 
                       Kernel
    4 00000000         ;
    5 00000000         ;                          (c) Copyright 1992-2003, Jean
                        J. Labrosse, Weston, FL
    6 00000000         ;                                          All Rights Re
                       served
    7 00000000         ;
    8 00000000         ;                                               ARM920T 
                       Port
    9 00000000         ;                                            ADS v1.2 Co
                       mpiler
   10 00000000         ;                                             Samsung S3
                       C2440A
   11 00000000         ;
   12 00000000         ; File    : os_cpu_a.s refrence to ucos application note
                        for arm AN-1014
   13 00000000         ; Des   : S3C2440 uC/OS-II Port 
   14 00000000         ; by      : tangxiaofeng xidian 503
   15 00000000         ; History : 
   16 00000000         ;  OSCtxSw(), OSIntCtxSw()  OSStartHighRdy() OS_CPU_IRQ_
                       ISR() OSTickISR()
   17 00000000         ;*******************************************************
                       ************************************************* */
   18 00000000         
   19 00000000 4A000000 
                       SRCPND  EQU              0x4a000000  ; Source pending
   20 00000000 4A000010 
                       INTPND  EQU              0x4a000010  ; Interrupt request
                                                             status
   21 00000000         
   22 00000000 560000A8 
                       rEINTPEND
                               EQU              0x560000a8
   23 00000000 4A000014 
                       INTOFFSET
                               EQU              0x4a000014
   24 00000000         
   25 00000000         
   26 00000000 00000010 
                       USERMODE
                               EQU              0x10
   27 00000000 00000011 
                       FIQMODE EQU              0x11
   28 00000000 00000012 
                       IRQMODE EQU              0x12
   29 00000000 00000013 
                       SVCMODE EQU              0x13
   30 00000000 00000017 
                       ABORTMODE
                               EQU              0x17
   31 00000000 0000001B 
                       UNDEFMODE
                               EQU              0x1b
   32 00000000 0000001F 



ARM Macro Assembler    Page 2 


                       MODEMASK
                               EQU              0x1f
   33 00000000 000000C0 
                       NOINT   EQU              0xc0
   34 00000000         
   35 00000000         ;*******************************************************
                       **************************************************
   36 00000000         ;                                    EXPORT and EXTERNAL
                        REFERENCES
   37 00000000         ;*******************************************************
                       **************************************************/
   38 00000000                 IMPORT           OSRunning
   39 00000000                 IMPORT           OSTCBCur
   40 00000000                 IMPORT           OSTCBHighRdy
   41 00000000                 IMPORT           OSPrioCur
   42 00000000                 IMPORT           OSPrioHighRdy
   43 00000000                 IMPORT           OSIntNesting
   44 00000000         
   45 00000000         
   46 00000000                 IMPORT           OSIntEnter
   47 00000000                 IMPORT           OSIntExit
   48 00000000                 IMPORT           OSTaskSwHook
   49 00000000                 IMPORT           OSTimeTick
   50 00000000         
   51 00000000                 IMPORT           HandleEINT0
   52 00000000         
   53 00000000         
   54 00000000                 EXPORT           OSStartHighRdy
   55 00000000                 EXPORT           OSCtxSw
   56 00000000                 EXPORT           OSTickISR
   57 00000000                 EXPORT           OSIntCtxSw
   58 00000000         
   59 00000000                 EXPORT           OSCPUSaveSR
   60 00000000                 EXPORT           OSCPURestoreSR
   61 00000000         
   62 00000000                 EXPORT           OS_CPU_IRQ_ISR
   63 00000000         
   64 00000000         
   65 00000000         
   66 00000000         
   67 00000000                 PRESERVE8
   68 00000000                 AREA             UCOS_ARM, CODE, READONLY
   69 00000000                 CODE32
   70 00000000         
   71 00000000         ;*******************************************************
                       **************************************************
   72 00000000         ;                                          START MULTITA
                       SKING
   73 00000000         ;                                       void OSStartHigh
                       Rdy(void)
   74 00000000         ;
   75 00000000         ; The stack frame is assumed to look as follows:
   76 00000000         ;
   77 00000000         ;           Entry Point(Task Name)    (High memory)
   78 00000000         ;                               LR(R14)
   79 00000000         ;                               R12
   80 00000000         ;                               R11
   81 00000000         ;                               R10
   82 00000000         ;                               R9



ARM Macro Assembler    Page 3 


   83 00000000         ;                               R8
   84 00000000         ;                               R7
   85 00000000         ;                               R6
   86 00000000         ;                               R5
   87 00000000         ;                               R4
   88 00000000         ;                               R3
   89 00000000         ;                               R2
   90 00000000         ;                               R1
   91 00000000         ;                               R0 : argument
   92 00000000         ; OSTCBHighRdy->OSTCBStkPtr --> CPSR        (Low memory)
                       
   93 00000000         ;
   94 00000000         ; Note : OSStartHighRdy() MUST:
   95 00000000         ;           a) Call OSTaskSwHook() then,
   96 00000000         ;           b) Set OSRunning to TRUE,
   97 00000000         ;           c) Switch to the highest priority task.
   98 00000000         ;*******************************************************
                       *************************************************** */
   99 00000000         OSStartHighRdy
  100 00000000         ;-------------------------------------------------------
                       --------------------------- 
  101 00000000         ; OSRunning = TRUE;
  102 00000000         ;-------------------------------------------------------
                       --------------------------- 
  103 00000000         
  104 00000000 E32FF0D3        MSR              CPSR_cxsf,#SVCMODE :or: NOINT ;
                                                            Switch to SVC mode 
                                                            with IRQ&FIQ disabl
                                                            e
  105 00000004         
  106 00000004 EBFFFFFE        BL               OSTaskSwHook ;Call user define 
                                                            Task switch hook
  107 00000008         
  108 00000008 E59F018C        LDR              R0, =OSRunning 
                                                            ; OSRunning =TRUE
  109 0000000C E3A01001        MOV              R1, #1
  110 00000010 E5C01000        STRB             R1, [R0]
  111 00000014         
  112 00000014         ;-------------------------------------------------------
                       ---------------------------  
  113 00000014         ;   SP = OSTCBHighRdy->OSTCBStkPtr;
  114 00000014         ;-------------------------------------------------------
                       --------------------------- 
  115 00000014 E59F0184        LDR              R0, =OSTCBHighRdy
  116 00000018 E5900000        LDR              R0, [R0]
  117 0000001C E590D000        LDR              SP, [R0]
  118 00000020         
  119 00000020         ;-------------------------------------------------------
                       ---------------------------  
  120 00000020         ; Prepare to return to proper mode
  121 00000020         ;-------------------------------------------------------
                       --------------------------- 
  122 00000020 E8BD0001        LDMFD            SP!, {R0}
  123 00000024 E16FF000        MSR              SPSR_cxsf, R0
  124 00000028 E8FDDFFF        LDMFD            SP!, {R0-R12, LR, PC}^
  125 0000002C         
  126 0000002C         
  127 0000002C         ;*******************************************************
                       ***************************************************



ARM Macro Assembler    Page 4 


  128 0000002C         ;                                PERFORM A CONTEXT SWITC
                       H (From task level)
  129 0000002C         ;                                           void OSCtxSw
                       (void)
  130 0000002C         ;
  131 0000002C         ; Note(s):     1) Upon entry: 
  132 0000002C         ;                 OSTCBCur      points to the OS_TCB of 
                       the task to suspend
  133 0000002C         ;                 OSTCBHighRdy  points to the OS_TCB of 
                       the task to resume
  134 0000002C         ;
  135 0000002C         ;              2) The stack frame of the task to suspend
                        looks as follows:
  136 0000002C         ;                                                   
  137 0000002C         ;                                                   PC  
                                         (High memory)
  138 0000002C         ;               LR(R14)     
  139 0000002C         ;                                    R12
  140 0000002C         ;                                     R11
  141 0000002C         ;                                    R10
  142 0000002C         ;                                     R9
  143 0000002C         ;                                    R8
  144 0000002C         ;                                    R7
  145 0000002C         ;                                    R6
  146 0000002C         ;                                    R5
  147 0000002C         ;                                    R4
  148 0000002C         ;                                    R3
  149 0000002C         ;                                    R2
  150 0000002C         ;                                    R1
  151 0000002C         ;                                    R0
  152 0000002C         ;       OSTCBCur->OSTCBStkPtr ----> CPSR     (Low memory
                       )
  153 0000002C         ;
  154 0000002C         ;
  155 0000002C         ;              3) The stack frame of the task to resume 
                       looks as follows:
  156 0000002C         ;
  157 0000002C         ;                 PC    (High memory)
  158 0000002C         ;                                                   LR(R
                       14) 
  159 0000002C         ;                                     R12
  160 0000002C         ;                                    R11
  161 0000002C         ;                                    R10
  162 0000002C         ;                                     R9
  163 0000002C         ;                                    R8
  164 0000002C         ;                                    R7
  165 0000002C         ;                                     R6
  166 0000002C         ;                                    R5
  167 0000002C         ;                                    R4
  168 0000002C         ;                                    R3
  169 0000002C         ;                                    R2
  170 0000002C         ;                                    R1
  171 0000002C         ;                                     R0
  172 0000002C         ;      OSTCBHighRdy->OSTCBStkPtr ----> CPSR     (Low mem
                       ory)
  173 0000002C         ;*******************************************************
                       **************************************************/
  174 0000002C         OSCtxSw
  175 0000002C         



ARM Macro Assembler    Page 5 


  176 0000002C E92D4000        STMFD            SP!, {LR}   ;PC
  177 00000030 E92D5FFF        STMFD            SP!, {R0-R12, LR} ;R0-R12 LR
  178 00000034 E10F0000        MRS              R0,  CPSR   ;Push CPSR
  179 00000038 E92D0001        STMFD            SP!, {R0}
  180 0000003C         
  181 0000003C         ;-------------------------------------------------------
                       ---------------------------
  182 0000003C         ;   OSTCBCur->OSTCBStkPtr = SP
  183 0000003C         ;-------------------------------------------------------
                       ---------------------------  
  184 0000003C E59F0160        LDR              R0, =OSTCBCur
  185 00000040 E5900000        LDR              R0, [R0]
  186 00000044 E580D000        STR              SP, [R0]
  187 00000048         
  188 00000048         ;-------------------------------------------------------
                       ---------------------------  
  189 00000048         ; OSTaskSwHook();
  190 00000048         ;-------------------------------------------------------
                       -------------------------- 
  191 00000048 EBFFFFFE        BL               OSTaskSwHook
  192 0000004C         
  193 0000004C         ;-------------------------------------------------------
                       ---------------------------   
  194 0000004C         ; OSTCBCur = OSTCBHighRdy;
  195 0000004C         ;-------------------------------------------------------
                       ---------------------------  
  196 0000004C E59F014C        LDR              R0, =OSTCBHighRdy
  197 00000050 E59F114C        LDR              R1, =OSTCBCur
  198 00000054 E5900000        LDR              R0, [R0]
  199 00000058 E5810000        STR              R0, [R1]
  200 0000005C         
  201 0000005C         ;-------------------------------------------------------
                       ---------------------------  
  202 0000005C         ; OSPrioCur = OSPrioHighRdy;
  203 0000005C         ;-------------------------------------------------------
                       ---------------------------  
  204 0000005C E59F0144        LDR              R0, =OSPrioHighRdy
  205 00000060 E59F1144        LDR              R1, =OSPrioCur
  206 00000064 E5D00000        LDRB             R0, [R0]
  207 00000068 E5C10000        STRB             R0, [R1]
  208 0000006C         
  209 0000006C         ;-------------------------------------------------------
                       ---------------------------  
  210 0000006C         ;  OSTCBHighRdy->OSTCBStkPtr;
  211 0000006C         ;-------------------------------------------------------
                       ---------------------------  
  212 0000006C E59F012C        LDR              R0, =OSTCBHighRdy
  213 00000070 E5900000        LDR              R0, [R0]
  214 00000074 E590D000        LDR              SP, [R0]
  215 00000078         
  216 00000078         ;-------------------------------------------------------
                       --------------------------- 
  217 00000078         ;Restore New task context
  218 00000078         ;-------------------------------------------------------
                       --------------------------- 
  219 00000078 E8BD0001        LDMFD            SP!, {R0}   ;POP CPSR
  220 0000007C E16FF000        MSR              SPSR_cxsf, R0
  221 00000080 E8FDDFFF        LDMFD            SP!, {R0-R12, LR, PC}^
  222 00000084         



ARM Macro Assembler    Page 6 


  223 00000084         
  224 00000084         ;*******************************************************
                       **************************************************
  225 00000084         ;                                            TICK HANDLE
                       R
  226 00000084         ;
  227 00000084         ; Description:  
  228 00000084         ;     This handles all the Timer4(INT_TIMER4) interrupt 
                       which is used to generate the uC/OS-II tick.
  229 00000084         ;*******************************************************
                       **************************************************/
  230 00000084         
  231 00000084         OSTickISR
  232 00000084 E1A0500E        MOV              R5,LR
  233 00000088 E3A01001        MOV              R1, #1
  234 0000008C E1A01701        MOV              R1, R1, LSL #14 ; Timer4 Source
                                                             Pending Reg.
  235 00000090 E3A0044A        LDR              R0, =SRCPND
  236 00000094 E5902000        LDR              R2, [R0]
  237 00000098 E1811002        ORR              R1, R1,R2
  238 0000009C E5801000        STR              R1, [R0]
  239 000000A0         
  240 000000A0 E59F0108        LDR              R0, =INTPND
  241 000000A4 E5901000        LDR              R1, [R0]
  242 000000A8 E5801000        STR              R1, [R0]
  243 000000AC         
  244 000000AC         ;-------------------------------------------------------
                       ---------------------------  
  245 000000AC         ; OSTimeTick();
  246 000000AC         ;-------------------------------------------------------
                       --------------------------- 
  247 000000AC EBFFFFFE        BL               OSTimeTick
  248 000000B0         
  249 000000B0         
  250 000000B0 E12FFF15        BX               R5          ; Return  
  251 000000B4         
  252 000000B4         ;*******************************************************
                       **************************************************
  253 000000B4         ;                                PERFORM A CONTEXT SWITC
                       H (From an ISR)
  254 000000B4         ;                                        void OSIntCtxSw
                       (void)
  255 000000B4         ;
  256 000000B4         ; Description: 1) This code performs a context switch if
                        a higher priority task has been made ready-to-run
  257 000000B4         ;                during an ISR.
  258 000000B4         ;
  259 000000B4         ;              2) The stack frame of the task to suspend
                        looks as follows:
  260 000000B4         ;
  261 000000B4         ;               PC     (High memory)
  262 000000B4         ;                                                   LR(R
                       14)
  263 000000B4         ;                                    R12
  264 000000B4         ;                                     R11
  265 000000B4         ;                                    R10
  266 000000B4         ;                                     R9
  267 000000B4         ;                                    R8
  268 000000B4         ;                                    R7



ARM Macro Assembler    Page 7 


  269 000000B4         ;                                    R6
  270 000000B4         ;                                    R5
  271 000000B4         ;                                    R4
  272 000000B4         ;                                    R3
  273 000000B4         ;                                    R2
  274 000000B4         ;                                    R1
  275 000000B4         ;                                    R0
  276 000000B4         ;                                    
  277 000000B4         ;       OSTCBCur->OSTCBStkPtr ----> CPSR     (Low memory
                       )
  278 000000B4         ;
  279 000000B4         ;
  280 000000B4         ;              3) The stack frame of the task to resume 
                       looks as follows:
  281 000000B4         ;
  282 000000B4         ;                 PC     (High memory)
  283 000000B4         ;                                                   LR(R
                       14) 
  284 000000B4         ;                                     R12
  285 000000B4         ;                                    R11
  286 000000B4         ;                                    R10
  287 000000B4         ;                                     R9
  288 000000B4         ;                                    R8
  289 000000B4         ;                                    R7
  290 000000B4         ;                                     R6
  291 000000B4         ;                                    R5
  292 000000B4         ;                                    R4
  293 000000B4         ;                                    R3
  294 000000B4         ;                                    R2
  295 000000B4         ;                                    R1
  296 000000B4         ;                                     R0
  297 000000B4         ;      OSTCBHighRdy->OSTCBStkPtr ----> CPSR     (Low mem
                       ory)
  298 000000B4         ;*******************************************************
                       **************************************************/
  299 000000B4         OSIntCtxSw
  300 000000B4         ;-------------------------------------------------------
                       ---------------------------  
  301 000000B4         ; Call OSTaskSwHook();
  302 000000B4         ;-------------------------------------------------------
                       --------------------------- 
  303 000000B4 EBFFFFFE        BL               OSTaskSwHook
  304 000000B8         
  305 000000B8         ;-------------------------------------------------------
                       ---------------------------   
  306 000000B8         ; OSTCBCur = OSTCBHighRdy;
  307 000000B8         ;-------------------------------------------------------
                       ---------------------------  
  308 000000B8 E59F00E0        LDR              R0, =OSTCBHighRdy
  309 000000BC E59F10E0        LDR              R1, =OSTCBCur
  310 000000C0 E5900000        LDR              R0, [R0]
  311 000000C4 E5810000        STR              R0, [R1]
  312 000000C8         
  313 000000C8         ;-------------------------------------------------------
                       ---------------------------  
  314 000000C8         ; OSPrioCur = OSPrioHighRdy;
  315 000000C8         ;-------------------------------------------------------
                       ---------------------------  
  316 000000C8 E59F00D8        LDR              R0, =OSPrioHighRdy



ARM Macro Assembler    Page 8 


  317 000000CC E59F10D8        LDR              R1, =OSPrioCur
  318 000000D0 E5D00000        LDRB             R0, [R0]
  319 000000D4 E5C10000        STRB             R0, [R1]
  320 000000D8         
  321 000000D8         ;-------------------------------------------------------
                       ---------------------------  
  322 000000D8         ;   SP = OSTCBHighRdy->OSTCBStkPtr;
  323 000000D8         ;-------------------------------------------------------
                       ---------------------------  
  324 000000D8 E59F00C0        LDR              R0, =OSTCBHighRdy
  325 000000DC E5900000        LDR              R0, [R0]
  326 000000E0 E590D000        LDR              SP, [R0]
  327 000000E4         
  328 000000E4         ;-------------------------------------------------------
                       --------------------------- 
  329 000000E4         ; Restore New Task context
  330 000000E4         ;-------------------------------------------------------
                       --------------------------- 
  331 000000E4 E8BD0001        LDMFD            SP!, {R0}   ;POP CPSR
  332 000000E8 E16FF000        MSR              SPSR_cxsf, R0
  333 000000EC E8FDDFFF        LDMFD            SP!, {R0-R12, LR, PC}^
  334 000000F0         
  335 000000F0         
  336 000000F0         
  337 000000F0         OS_CPU_IRQ_ISR
  338 000000F0         
  339 000000F0 E92D000E        STMFD            SP!, {R1-R3} ; We will use R1-R
                                                            3 as temporary regi
                                                            sters
  340 000000F4         ;-------------------------------------------------------
                       ---------------------
  341 000000F4         ;   R1--SP
  342 000000F4         ; R2--PC 
  343 000000F4         ;   R3--SPSR
  344 000000F4         ;-------------------------------------------------------
                       -----------------
  345 000000F4 E1A0100D        MOV              R1, SP      ;Save¡¡ IRQ stack p
                                                            ointer
  346 000000F8 E28DD00C        ADD              SP, SP, #12 ;Adjust IRQ stack p
                                                            ointer
  347 000000FC E24E2004        SUB              R2, LR, #4  ;Adjust PC for retu
                                                            rn address to task
  348 00000100         
  349 00000100 E14F3000        MRS              R3, SPSR    ; Copy SPSR (Task C
                                                            PSR)
  350 00000104         
  351 00000104         
  352 00000104         
  353 00000104 E32FF0D3        MSR              CPSR_cxsf, #SVCMODE :or: NOINT 
                                                            ;Change to SVC mode
                                                            
  354 00000108         
  355 00000108         ; SAVE TASK''S CONTEXT ONTO OLD TASK''S STACK
  356 00000108         
  357 00000108 E92D0004        STMFD            SP!, {R2}   ; Push task''s PC  
                                                            
  358 0000010C         
  359 0000010C E92D5FF0        STMFD            SP!, {R4-R12, LR} ; Push task''
                                                            s LR,R12-R4



ARM Macro Assembler    Page 9 


  360 00000110         
  361 00000110 E8B10070        LDMFD            R1!, {R4-R6} ; Load Task''s R1-
                                                            R3 from IRQ stack 
  362 00000114 E92D0070        STMFD            SP!, {R4-R6} ; Push Task''s R1-
                                                            R3 to SVC stack
  363 00000118 E92D0001        STMFD            SP!, {R0}   ; Push Task''s R0 t
                                                            o SVC stack
  364 0000011C         
  365 0000011C E92D0008        STMFD            SP!, {R3}   ; Push task''s CPSR
                                                            
  366 00000120         
  367 00000120 E59F008C        LDR              R0,=OSIntNesting 
                                                            ;OSIntNesting++
  368 00000124 E5D01000        LDRB             R1,[R0]
  369 00000128 E2811001        ADD              R1,R1,#1
  370 0000012C E5C01000        STRB             R1,[R0]
  371 00000130         
  372 00000130 E3510001        CMP              R1,#1       ;if(OSIntNesting==1
                                                            ){
  373 00000134 1A000002        BNE              %F1
  374 00000138         
  375 00000138 E59F4064        LDR              R4,=OSTCBCur ;OSTCBHighRdy->OST
                                                            CBStkPtr=SP;
  376 0000013C E5945000        LDR              R5,[R4]
  377 00000140 E585D000        STR              SP,[R5]     ;}
  378 00000144         
  379 00000144         1
  380 00000144 E321F0D2        MSR              CPSR_c,#IRQMODE :or: NOINT ;Cha
                                                            nge to IRQ mode to 
                                                            use IRQ stack to ha
                                                            ndle interrupt
  381 00000148         
  382 00000148 E59F0068        LDR              R0, =INTOFFSET
  383 0000014C E5900000        LDR              R0, [R0]
  384 00000150         
  385 00000150 E59F1018        LDR              R1, IRQIsrVect
  386 00000154 E1A0E00F        MOV              LR, PC      ; Save LR befor jum
                                                            p to the C function
                                                             we need return bac
                                                            k
  387 00000158 E791F100        LDR              PC, [R1, R0, LSL #2] ; Call OS_
                                                            CPU_IRQ_ISR_handler
                                                            ();   
  388 0000015C         
  389 0000015C E321F0D3        MSR              CPSR_c,#SVCMODE :or: NOINT 
                                                            ;Change to SVC mode
                                                            
  390 00000160 EBFFFFFE        BL               OSIntExit   ;Call OSIntExit
  391 00000164         
  392 00000164 E8BD0010        LDMFD            SP!,{R4}    ;POP the task''s CP
                                                            SR 
  393 00000168 E16FF004        MSR              SPSR_cxsf,R4
  394 0000016C E8FDDFFF        LDMFD            SP!,{R0-R12,LR,PC}^ ;POP new Ta
                                                            sk''s context
  395 00000170         
  396 00000170 00000000 
                       IRQIsrVect
                               DCD              HandleEINT0
  397 00000174         



ARM Macro Assembler    Page 10 


  398 00000174         ;*******************************************************
                       **************************************************
  399 00000174         ;                                   CRITICAL SECTION MET
                       HOD 3 FUNCTIONS
  400 00000174         ;
  401 00000174         ; Description: Disable/Enable interrupts by preserving t
                       he state of interrupts.  Generally speaking you
  402 00000174         ;              would store the state of the interrupt di
                       sable flag in the local variable 'cpu_sr' and then
  403 00000174         ;              disable interrupts.  'cpu_sr' is allocate
                       d in all of uC/OS-II''s functions that need to 
  404 00000174         ;              disable interrupts.  You would restore th
                       e interrupt disable state by copying back 'cpu_sr'
  405 00000174         ;              into the CPU''s status register.
  406 00000174         ;
  407 00000174         ; Prototypes : OS_CPU_SR  OSCPUSaveSR(void);
  408 00000174         ;              void       OSCPURestoreSR(OS_CPU_SR cpu_s
                       r);
  409 00000174         ;
  410 00000174         ;
  411 00000174         ; Note(s)    : 1) These functions are used in general li
                       ke this:
  412 00000174         ;
  413 00000174         ;                 void Task (void *p_arg)
  414 00000174         ;                 {
  415 00000174         ;                 #if OS_CRITICAL_METHOD == 3          /
                       * Allocate storage for CPU status register */
  416 00000174         ;                     OS_CPU_SR  cpu_sr;
  417 00000174         ;                 #endif
  418 00000174         ;
  419 00000174         ;                          :
  420 00000174         ;                          :
  421 00000174         ;                     OS_ENTER_CRITICAL();             /
                       * cpu_sr = OSCPUSaveSR();                */
  422 00000174         ;                          :
  423 00000174         ;                          :
  424 00000174         ;                     OS_EXIT_CRITICAL();              /
                       * OSCPURestoreSR(cpu_sr);                */
  425 00000174         ;                          :
  426 00000174         ;                          :
  427 00000174         ;                 }
  428 00000174         ;
  429 00000174         ;              2) OSCPUSaveSR() is implemented as recomm
                       ended by Atmel''s application note:
  430 00000174         ;
  431 00000174         ;                    "Disabling Interrupts at Processor 
                       Level"
  432 00000174         ;*******************************************************
                       **************************************************
  433 00000174         OSCPUSaveSR
  434 00000174 E10F0000        MRS              R0, CPSR    ; Set IRQ and FIQ b
                                                            its in CPSR to disa
                                                            ble all interrupts
  435 00000178 E38010C0        ORR              R1, R0, #0xC0
  436 0000017C E121F001        MSR              CPSR_c, R1
  437 00000180 E10F1000        MRS              R1, CPSR    ; Confirm that CPSR
                                                             contains the prope
                                                            r interrupt disable
                                                             flags



ARM Macro Assembler    Page 11 


  438 00000184 E20110C0        AND              R1, R1, #0xC0
  439 00000188 E35100C0        CMP              R1, #0xC0
  440 0000018C 1AFFFFFE        BNE              OSCPUSaveSR ; Not properly disa
                                                            bled (try again)
  441 00000190 E12FFF1E        BX               LR          ; Disabled, return 
                                                            the original CPSR c
                                                            ontents in R0
  442 00000194         
  443 00000194         OSCPURestoreSR
  444 00000194 E121F000        MSR              CPSR_c, R0
  445 00000198 E12FFF1E        BX               LR
  446 0000019C         
  447 0000019C                 END
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              4A000010 
              00000000 
              4A000014 
Command Line: --debug --xref --cpu=ARM920T --apcs=interwork --depend=.\OutPutFi
les\Os_cpu_a.d -o.\OutPutFiles\Os_cpu_a.o -I.\CommonFiles\FL2440_BSP\2440BSP_IN
C -IE:\Keil\ARM\CMSIS\Include -IE:\Keil\ARM\INC\Samsung --list=.\Os_cpu_a.lst C
ommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

 00000144

Symbol: 
   Definitions
      None
   Uses
      None
Warning:  undefinedComment:  unused
IRQIsrVect 00000170

Symbol: IRQIsrVect
   Definitions
      At line 396 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 385 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: IRQIsrVect used once
OSCPURestoreSR 00000194

Symbol: OSCPURestoreSR
   Definitions
      At line 443 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 60 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSCPURestoreSR used once
OSCPUSaveSR 00000174

Symbol: OSCPUSaveSR
   Definitions
      At line 433 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 59 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 440 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s

OSCtxSw 0000002C

Symbol: OSCtxSw
   Definitions
      At line 174 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 55 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSCtxSw used once
OSIntCtxSw 000000B4

Symbol: OSIntCtxSw
   Definitions
      At line 299 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 57 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSIntCtxSw used once
OSStartHighRdy 00000000

Symbol: OSStartHighRdy
   Definitions
      At line 99 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 54 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSStartHighRdy used once
OSTickISR 00000084




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Symbol: OSTickISR
   Definitions
      At line 231 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 56 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSTickISR used once
OS_CPU_IRQ_ISR 000000F0

Symbol: OS_CPU_IRQ_ISR
   Definitions
      At line 337 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 62 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OS_CPU_IRQ_ISR used once
UCOS_ARM 00000000

Symbol: UCOS_ARM
   Definitions
      At line 68 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: UCOS_ARM unused
10 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

ABORTMODE 00000017

Symbol: ABORTMODE
   Definitions
      At line 30 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: ABORTMODE unused
FIQMODE 00000011

Symbol: FIQMODE
   Definitions
      At line 27 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: FIQMODE unused
INTOFFSET 4A000014

Symbol: INTOFFSET
   Definitions
      At line 23 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 382 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: INTOFFSET used once
INTPND 4A000010

Symbol: INTPND
   Definitions
      At line 20 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 240 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: INTPND used once
IRQMODE 00000012

Symbol: IRQMODE
   Definitions
      At line 28 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 380 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: IRQMODE used once
MODEMASK 0000001F

Symbol: MODEMASK
   Definitions
      At line 32 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: MODEMASK unused
NOINT 000000C0

Symbol: NOINT
   Definitions
      At line 33 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 104 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 353 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 380 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 389 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

SRCPND 4A000000

Symbol: SRCPND
   Definitions
      At line 19 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 235 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: SRCPND used once
SVCMODE 00000013

Symbol: SVCMODE
   Definitions
      At line 29 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 104 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 353 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 389 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s

UNDEFMODE 0000001B

Symbol: UNDEFMODE
   Definitions
      At line 31 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: UNDEFMODE unused
USERMODE 00000010

Symbol: USERMODE
   Definitions
      At line 26 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: USERMODE unused
rEINTPEND 560000A8

Symbol: rEINTPEND
   Definitions
      At line 22 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: rEINTPEND unused
12 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

HandleEINT0 00000000

Symbol: HandleEINT0
   Definitions
      At line 51 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 396 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: HandleEINT0 used once
OSIntEnter 00000000

Symbol: OSIntEnter
   Definitions
      At line 46 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      None
Comment: OSIntEnter unused
OSIntExit 00000000

Symbol: OSIntExit
   Definitions
      At line 47 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 390 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSIntExit used once
OSIntNesting 00000000

Symbol: OSIntNesting
   Definitions
      At line 43 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 367 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSIntNesting used once
OSPrioCur 00000000

Symbol: OSPrioCur
   Definitions
      At line 41 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 205 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 317 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s

OSPrioHighRdy 00000000

Symbol: OSPrioHighRdy
   Definitions
      At line 42 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 204 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 316 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s

OSRunning 00000000

Symbol: OSRunning
   Definitions
      At line 38 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 108 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSRunning used once
OSTCBCur 00000000



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
External symbols


Symbol: OSTCBCur
   Definitions
      At line 39 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 184 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 197 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 309 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 375 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s

OSTCBHighRdy 00000000

Symbol: OSTCBHighRdy
   Definitions
      At line 40 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 115 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 196 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 212 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 308 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 324 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s

OSTaskSwHook 00000000

Symbol: OSTaskSwHook
   Definitions
      At line 48 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 106 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 191 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
      At line 303 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s

OSTimeTick 00000000

Symbol: OSTimeTick
   Definitions
      At line 49 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
   Uses
      At line 247 in file CommonFiles\uCOS-II\uCOS-II_BSP\Os_cpu_a.s
Comment: OSTimeTick used once
11 symbols
358 symbols in table
